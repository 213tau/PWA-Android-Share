<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FileShare PWA</title>
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <h1>Shared Files</h1>
  <div id="file-list"></div>

  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('SW registered'))
        .catch(err => console.error('SW failed:', err));
    }

    // Load files from IndexedDB
    async function loadSharedFiles() {
      return new Promise((resolve) => {
        const dbReq = indexedDB.open("shared-files", 1);

        dbReq.onupgradeneeded = () => {
          dbReq.result.createObjectStore("files", { autoIncrement: true });
        };

        dbReq.onsuccess = () => {
          const db = dbReq.result;
          const tx = db.transaction("files", "readonly");
          const store = tx.objectStore("files");
          const getAll = store.getAll();
          getAll.onsuccess = () => resolve(getAll.result);
        };
      });
    }

    loadSharedFiles().then(files => {
      const list = document.getElementById("file-list");
      if (!files.length) {
        list.innerHTML = "<p>No shared files yet.</p>";
      } else {
        files.forEach(file => {
          const url = URL.createObjectURL(file);
          const item = document.createElement("div");
          item.innerHTML = `<p>${file.name} (${file.type})</p>`;
          if (file.type.startsWith("image/")) {
            item.innerHTML += `<img src="${url}" width="200">`;
          }
          list.appendChild(item);
        });
      }
    });
  </script>
</body>
</html>
